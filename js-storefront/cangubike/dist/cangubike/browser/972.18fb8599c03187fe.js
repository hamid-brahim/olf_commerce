"use strict";(self.webpackChunkcangubike=self.webpackChunkcangubike||[]).push([[972],{6972:(j,b,p)=>{p.r(b),p.d(b,{CPQ_CONFIGURATOR_ADD_TO_CART_SERIALIZER:()=>U,CPQ_CONFIGURATOR_NORMALIZER:()=>T,CPQ_CONFIGURATOR_OVERVIEW_NORMALIZER:()=>P,CPQ_CONFIGURATOR_QUANTITY_SERIALIZER:()=>R,CPQ_CONFIGURATOR_SERIALIZER:()=>N,CPQ_CONFIGURATOR_UPDATE_CART_ENTRY_SERIALIZER:()=>S,Cpq:()=>c,CpqConfiguratorEndpointConfig:()=>B,CpqConfiguratorEndpointService:()=>Q,CpqConfiguratorNormalizer:()=>F,CpqConfiguratorNormalizerUtilsService:()=>D,CpqConfiguratorOccModule:()=>q,CpqConfiguratorOccService:()=>V,CpqConfiguratorOverviewNormalizer:()=>z,CpqConfiguratorRestAdapter:()=>W,CpqConfiguratorRestModule:()=>k,CpqConfiguratorRestService:()=>K,CpqConfiguratorSerializer:()=>w,CpqConfiguratorUtils:()=>v,CpqConfiguratorValueSerializer:()=>G,OccConfiguratorCpqAddToCartSerializer:()=>M,OccConfiguratorCpqUpdateCartEntrySerializer:()=>L,RulebasedCpqConfiguratorModule:()=>Z});var u=p(4650),I=p(6895),f=p(6322),m=p(3749),d=p(4850),h=p(2986),C=p(7545),O=p(529),Y=p(6506),a=p(2865),$=p(2535),_=p(1086),X=p(567);const U=new u.OlP("CpqConfiguratorAddToCartSerializer"),S=new u.OlP("CpqConfiguratorUpdateCartEntrySerializer");let M=(()=>{class i{convert(e,t){return{...t,userId:e.userId,cartId:e.cartId,product:{code:e.productCode},quantity:e.quantity,configId:e.configId}}}return i.\u0275fac=function(e){return new(e||i)},i.\u0275prov=u.Yz7({token:i,factory:i.\u0275fac,providedIn:"root"}),i})(),L=(()=>{class i{convert(e,t){return{...t,userId:e.userId,cartId:e.cartId,entryNumber:e.cartEntryNumber,configId:e.configuration.configId}}}return i.\u0275fac=function(e){return new(e||i)},i.\u0275prov=u.Yz7({token:i,factory:i.\u0275fac,providedIn:"root"}),i})();function H(){return{backend:{occ:{endpoints:{getCpqAccessData:"users/${userId}/access/cpqconfigurator",addCpqConfigurationToCart:"users/${userId}/carts/${cartId}/entries/cpqconfigurator",readCpqConfigurationForCartEntry:"users/${userId}/carts/${cartId}/entries/${cartEntryNumber}/cpqconfigurator",readCpqConfigurationForOrderEntry:"users/${userId}/orders/${orderId}/entries/${orderEntryNumber}/cpqconfigurator",updateCpqConfigurationForCartEntry:"users/${userId}/carts/${cartId}/entries/${cartEntryNumber}/cpqconfigurator"}}}}}let q=(()=>{class i{}return i.\u0275fac=function(e){return new(e||i)},i.\u0275mod=u.oAB({type:i}),i.\u0275inj=u.cJS({providers:[(0,f.x2j)(H),{provide:U,useExisting:M,multi:!0},{provide:S,useExisting:L,multi:!0}],imports:[I.ez]}),i})(),V=(()=>{class i{constructor(e,t,r){this.http=e,this.occEndpointsService=t,this.converterService=r}addToCart(e){const t=this.occEndpointsService.buildUrl("addCpqConfigurationToCart",{urlParams:{userId:e.userId,cartId:e.cartId}}),r=this.converterService.convert(e,U);return this.http.post(t,r).pipe(this.converterService.pipeable(m.Ke))}updateCartEntry(e){const t=this.occEndpointsService.buildUrl("updateCpqConfigurationForCartEntry",{urlParams:{userId:e.userId,cartId:e.cartId,cartEntryNumber:e.cartEntryNumber}}),r=this.converterService.convert(e,S);return this.http.put(t,r).pipe(this.converterService.pipeable(m.Ke))}getConfigIdForCartEntry(e){const t=this.occEndpointsService.buildUrl("readCpqConfigurationForCartEntry",{urlParams:{userId:e.userId,cartId:e.cartId,cartEntryNumber:e.cartEntryNumber}});return this.http.get(t).pipe((0,d.U)(r=>r.configId))}getConfigIdForOrderEntry(e){const t=this.occEndpointsService.buildUrl("readCpqConfigurationForOrderEntry",{urlParams:{userId:e.userId,orderId:e.orderId,orderEntryNumber:e.orderEntryNumber}});return this.http.get(t).pipe((0,d.U)(r=>r.configId))}}return i.\u0275fac=function(e){return new(e||i)(u.LFG(O.eN),u.LFG(f.Lz0),u.LFG(f.IXI))},i.\u0275prov=u.Yz7({token:i,factory:i.\u0275fac,providedIn:"root"}),i})();var c;!function(i){let s;var t;let e;(t=s=i.DisplayAs||(i.DisplayAs={}))[t.RADIO_BUTTON=1]="RADIO_BUTTON",t[t.CHECK_BOX=2]="CHECK_BOX",t[t.DROPDOWN=3]="DROPDOWN",t[t.LIST_BOX=4]="LIST_BOX",t[t.LIST_BOX_MULTI=5]="LIST_BOX_MULTI",t[t.READ_ONLY=71]="READ_ONLY",t[t.INPUT=95]="INPUT",t[t.AUTO_COMPLETE_CUSTOM=102]="AUTO_COMPLETE_CUSTOM",function(t){t.INPUT_STRING="String",t.INPUT_NUMBER="Number",t.QTY_ATTRIBUTE_LEVEL="Quantity",t.QTY_VALUE_LEVEL="Attr.Quantity",t.N_A="N/A"}(e=i.DataType||(i.DataType={}))}(c||(c={}));let D=(()=>{class i{constructor(e){this.languageService=e}convertQuantity(e,t){if(!e.selected)return;let n;switch(this.convertDataType(t)){case a.Configurator.DataType.USER_SELECTION_QTY_ATTRIBUTE_LEVEL:n=Number(t.quantity);break;case a.Configurator.DataType.USER_SELECTION_QTY_VALUE_LEVEL:n=Number(e.quantity);break;default:n=void 0}return n}convertValuePrice(e,t){let r;return e.price&&(r={currencyIso:t,value:parseFloat(e.price)},this.formatPriceForLocale(r,this.getLanguage())),r}calculateValuePriceTotal(e,t){let r;return t&&(r={currencyIso:t.currencyIso,value:(e||1)*t.value},this.formatPriceForLocale(r,this.getLanguage())),r}calculateAttributePriceTotal(e,t){const r=e.values?.filter(o=>o.selected&&o.valuePriceTotal).reduce((o,l)=>o+(l.valuePriceTotal?.value??0),0),n={currencyIso:t,value:r??0};return this.formatPriceForLocale(n,this.getLanguage()),n}formatPriceForLocale(e,t){const r=(0,I.jK)(e.currencyIso,"narrow",t);e.formattedValue=(0,I.xG)(e.value,t,r,e.currencyIso)}convertDataType(e){let t;switch(e.dataType){case c.DataType.INPUT_STRING:t=a.Configurator.DataType.INPUT_STRING;break;case c.DataType.INPUT_NUMBER:t=a.Configurator.DataType.INPUT_NUMBER;break;case c.DataType.N_A:t=a.Configurator.DataType.USER_SELECTION_NO_QTY;break;case c.DataType.QTY_ATTRIBUTE_LEVEL:t=a.Configurator.DataType.USER_SELECTION_QTY_ATTRIBUTE_LEVEL;break;case c.DataType.QTY_VALUE_LEVEL:t=e.displayAs===c.DisplayAs.RADIO_BUTTON||e.displayAs===c.DisplayAs.DROPDOWN||e.displayAs===c.DisplayAs.CHECK_BOX&&!e.isLineItem?a.Configurator.DataType.USER_SELECTION_NO_QTY:a.Configurator.DataType.USER_SELECTION_QTY_VALUE_LEVEL;break;default:t=a.Configurator.DataType.NOT_IMPLEMENTED}return t}convertPriceSummary(e){const t={};if(e.currencyISOCode){const r=e.currencyISOCode;if(e?.responder?.totalPrice&&e?.currencySign){const n=e?.currencySign,o=e.responder.totalPrice.replace(n,""),l={currencyIso:r,value:parseFloat(o)};this.formatPriceForLocale(l,this.getLanguage()),t.currentTotal=l}if(e?.responder?.baseProductPrice){const o={currencyIso:r,value:parseFloat(e.responder.baseProductPrice)};this.formatPriceForLocale(o,this.getLanguage()),t.basePrice=o}if(t.currentTotal&&t.basePrice){const n={currencyIso:r,value:t.currentTotal.value-t.basePrice.value};this.formatPriceForLocale(n,this.getLanguage()),t.selectedOptions=n}}return t}hasAnyProducts(e){return e.some(t=>t?.productSystemId)}convertAttributeLabel(e){return e.label?e.label:e.name?e.name:""}getLanguage(){const e=this.getActiveLanguage();try{return(0,I.wM)(e),e}catch{return this.reportMissingLocaleData(e),"en"}}getActiveLanguage(){let e;return this.languageService.getActive().subscribe(t=>e=t).unsubscribe(),e??"en"}reportMissingLocaleData(e){(0,u.X6Q)()&&console.warn(`CpqConfiguratorNormalizerUtilsService: No locale data registered for '${e}' (see https://angular.io/api/common/registerLocaleData).`)}}return i.\u0275fac=function(e){return new(e||i)(u.LFG(f.TSl))},i.\u0275prov=u.Yz7({token:i,factory:i.\u0275fac,providedIn:"root"}),i})(),F=(()=>{class i{constructor(e,t){this.cpqConfiguratorNormalizerUtilsService=e,this.translation=t}convert(e,t){const r={...t,configId:"",complete:!e.incompleteAttributes?.length,consistent:!(e.invalidMessages?.length||e.failedValidations?.length||e.incompleteMessages?.length||e.errorMessages?.length),totalNumberOfIssues:this.generateTotalNumberOfIssues(e),productCode:e.productSystemId,priceSummary:this.cpqConfiguratorNormalizerUtilsService.convertPriceSummary(e),groups:[],flatGroups:[],owner:Y.mR.createInitialOwner(),interactionState:{},errorMessages:this.generateErrorMessages(e),warningMessages:this.generateWarningMessages(e),pricingEnabled:!0};return e.tabs?.forEach(n=>this.convertGroup(n,e.attributes??[],e.currencyISOCode,r.groups,r.flatGroups)),(!r.groups||0===r.groups.length)&&this.convertGenericGroup(e.attributes??[],e.incompleteAttributes??[],e.currencyISOCode,r.groups,r.flatGroups),r}generateTotalNumberOfIssues(e){return(e.incompleteAttributes?.length??0)+(e.incompleteMessages?.length??0)+(e.invalidMessages?.length??0)+(e.failedValidations?.length??0)+(e.errorMessages?.length??0)}generateWarningMessages(e){let t=[];return t=t.concat(e.failedValidations??[]),t=t.concat(e.incompleteMessages??[]),t}generateErrorMessages(e){let t=[];return t=t.concat(e.errorMessages??[]),t=t.concat(e.invalidMessages??[]),t}convertGroup(e,t,r,n,o){const l=[];e.isSelected&&t.forEach(E=>this.convertAttribute(E,e.id,r,l));const g={id:e.id.toString(),name:e.name,description:e.displayName,configurable:!0,complete:!e.isIncomplete,consistent:!0,groupType:a.Configurator.GroupType.ATTRIBUTE_GROUP,attributes:l,subGroups:[]};o.push(g),n.push(g)}convertGenericGroup(e,t,r,n,o){const l=[];e.forEach(E=>this.convertAttribute(E,0,r,l));const g={id:"0",name:"_GEN",configurable:!0,complete:0===t.length,consistent:!0,groupType:a.Configurator.GroupType.ATTRIBUTE_GROUP,attributes:l,subGroups:[]};this.translation.translate("configurator.group.general").pipe((0,h.q)(1)).subscribe(E=>g.description=E),n.push(g),o.push(g)}convertAttribute(e,t,r,n){const o={attrCode:e.stdAttrCode,name:e.pA_ID.toString(),description:e.description,label:this.cpqConfiguratorNormalizerUtilsService.convertAttributeLabel(e),required:e.required,isLineItem:e.isLineItem,uiType:this.convertAttributeType(e),dataType:this.cpqConfiguratorNormalizerUtilsService.convertDataType(e),quantity:Number(e.quantity),groupId:t.toString(),userInput:e.userInput,hasConflicts:e.hasConflict,selectedSingleValue:void 0,images:[],visible:!0};if(e.values&&e.displayAs!==c.DisplayAs.INPUT){const l=[];e.values.forEach(g=>this.convertValue(g,e,r,l)),o.values=l,this.setSelectedSingleValue(o)}o.attributePriceTotal=this.cpqConfiguratorNormalizerUtilsService.calculateAttributePriceTotal(o,r),this.compileAttributeIncomplete(o),n.push(o)}setSelectedSingleValue(e){const t=e.values;if(t){const r=t.map(n=>n).filter(n=>n.selected);r&&1===r.length&&(e.selectedSingleValue=r[0].valueCode)}}convertValueDisplay(e,t,r){t.displayAs===c.DisplayAs.DROPDOWN&&e.selected&&0===e.paV_ID?this.translation.translate("configurator.attribute.dropDownSelectMsg").pipe((0,h.q)(1)).subscribe(n=>r.valueDisplay=n):r.valueDisplay=e.valueDisplay}convertValue(e,t,r,n){if(this.hasValueToBeIgnored(t,e))return;const o={valueCode:e.paV_ID.toString(),name:e.valueCode,description:e.description,productSystemId:e.productSystemId,selected:e.selected,quantity:this.cpqConfiguratorNormalizerUtilsService.convertQuantity(e,t),valuePrice:this.cpqConfiguratorNormalizerUtilsService.convertValuePrice(e,r),images:[]};this.convertValueDisplay(e,t,o),o.valuePriceTotal=this.cpqConfiguratorNormalizerUtilsService.calculateValuePriceTotal(o.quantity??1,o.valuePrice),n.push(o)}convertAttributeType(e){const t=e.displayAs,r=!(!e.values||!this.cpqConfiguratorNormalizerUtilsService.hasAnyProducts(e.values));return e.isEnabled||t!==c.DisplayAs.RADIO_BUTTON&&t!==c.DisplayAs.DROPDOWN&&t!==c.DisplayAs.CHECK_BOX&&t!==c.DisplayAs.INPUT?this.findUiTypeFromDisplayType(t,r,e):a.Configurator.UiType.READ_ONLY}findUiTypeFromDisplayType(e,t,r){let n;switch(e){case c.DisplayAs.RADIO_BUTTON:n=t?a.Configurator.UiType.RADIOBUTTON_PRODUCT:a.Configurator.UiType.RADIOBUTTON;break;case c.DisplayAs.DROPDOWN:n=t?a.Configurator.UiType.DROPDOWN_PRODUCT:a.Configurator.UiType.DROPDOWN;break;case c.DisplayAs.CHECK_BOX:n=t?a.Configurator.UiType.CHECKBOXLIST_PRODUCT:a.Configurator.UiType.CHECKBOXLIST;break;case c.DisplayAs.INPUT:n=r.dataType===c.DataType.INPUT_STRING?a.Configurator.UiType.STRING:a.Configurator.UiType.NOT_IMPLEMENTED;break;default:n=a.Configurator.UiType.NOT_IMPLEMENTED}return n}compileAttributeIncomplete(e){switch(e.incomplete=!1,e.uiType){case a.Configurator.UiType.RADIOBUTTON:case a.Configurator.UiType.RADIOBUTTON_PRODUCT:case a.Configurator.UiType.DROPDOWN:case a.Configurator.UiType.DROPDOWN_PRODUCT:case a.Configurator.UiType.SINGLE_SELECTION_IMAGE:(!e.selectedSingleValue||"0"===e.selectedSingleValue)&&(e.incomplete=!0);break;case a.Configurator.UiType.NUMERIC:case a.Configurator.UiType.STRING:e.userInput||(e.incomplete=!0);break;case a.Configurator.UiType.CHECKBOXLIST:case a.Configurator.UiType.CHECKBOXLIST_PRODUCT:case a.Configurator.UiType.CHECKBOX:case a.Configurator.UiType.MULTI_SELECTION_IMAGE:void 0!==e.values?.find(r=>r.selected)||(e.incomplete=!0)}}hasValueToBeIgnored(e,t){const r=e.values?.map(n=>n).filter(n=>n.selected&&0!==n.paV_ID);return(e.displayAs===c.DisplayAs.DROPDOWN&&e.required&&r&&r.length>0&&0===t.paV_ID)??!1}}return i.\u0275fac=function(e){return new(e||i)(u.LFG(D),u.LFG(f.D7D))},i.\u0275prov=u.Yz7({token:i,factory:i.\u0275fac}),i})(),z=(()=>{class i{constructor(e,t){this.cpqConfiguratorNormalizerUtilsService=e,this.translation=t,this.NO_OPTION_SELECTED=0}convert(e,t){return{...t,configId:"",productCode:e.productSystemId,priceSummary:this.cpqConfiguratorNormalizerUtilsService.convertPriceSummary(e),groups:e.tabs?.flatMap(n=>this.convertTab(n,e.currencyISOCode)).filter(n=>n.attributes&&n.attributes.length>0),totalNumberOfIssues:this.calculateTotalNumberOfIssues(e)}}convertTab(e,t){let r=[];e.attributes?.forEach(o=>{r=r.concat(this.convertAttribute(o,t))});const n={id:e.id.toString(),groupDescription:e.displayName,attributes:r};return"0"===n.id&&this.translation.translate("configurator.group.general").pipe((0,h.q)(1)).subscribe(o=>n.groupDescription=o),n}convertAttribute(e,t){const r=e?.values&&this.cpqConfiguratorNormalizerUtilsService.hasAnyProducts(e?.values)?a.Configurator.AttributeOverviewType.BUNDLE:a.Configurator.AttributeOverviewType.GENERAL,n=[];return this.convertAttributeValue(e,t).forEach(o=>{n.push({...o,type:r,attribute:this.cpqConfiguratorNormalizerUtilsService.convertAttributeLabel(e),attributeId:e.stdAttrCode.toString()})}),n}convertAttributeValue(e,t){const r=[];switch(e.displayAs){case c.DisplayAs.INPUT:e?.dataType===c.DataType.INPUT_STRING?e.userInput&&e.userInput.length>0&&r.push(this.extractValueUserInput(e,t)):r.push({attribute:"",value:"NOT_IMPLEMENTED"});break;case c.DisplayAs.RADIO_BUTTON:case c.DisplayAs.DROPDOWN:const n=e.values?.find(o=>o.selected&&o.paV_ID!==this.NO_OPTION_SELECTED);n&&r.push(this.extractValue(n,e,t));break;case c.DisplayAs.CHECK_BOX:e.values?.filter(o=>o.selected)?.forEach(o=>{r.push(this.extractValue(o,e,t))});break;default:r.push({attribute:"",value:"NOT_IMPLEMENTED"})}return r}extractValue(e,t,r){const n={attribute:"",value:e.valueDisplay??e.paV_ID.toString(),valueId:e.paV_ID.toString(),productCode:e.productSystemId,quantity:this.cpqConfiguratorNormalizerUtilsService.convertQuantity(e,t),valuePrice:this.cpqConfiguratorNormalizerUtilsService.convertValuePrice(e,r)};return n.valuePriceTotal=this.cpqConfiguratorNormalizerUtilsService.calculateValuePriceTotal(n.quantity??1,n.valuePrice),n}extractValueUserInput(e,t){const r=e.values?e.values[0]:void 0,n={attribute:"",value:e.userInput??e.stdAttrCode.toString(),valueId:r?.paV_ID.toString(),quantity:1};return r&&(n.valuePrice=this.cpqConfiguratorNormalizerUtilsService.convertValuePrice(r,t),n.valuePriceTotal=this.cpqConfiguratorNormalizerUtilsService.calculateValuePriceTotal(n.quantity??1,n.valuePrice)),n}calculateTotalNumberOfIssues(e){return(e.incompleteAttributes?.length??0)+(e.incompleteMessages?.length??0)+(e.invalidMessages?.length??0)+(e.failedValidations?.length??0)+(e.errorMessages?.length??0)}}return i.\u0275fac=function(e){return new(e||i)(u.LFG(D),u.LFG(f.D7D))},i.\u0275prov=u.Yz7({token:i,factory:i.\u0275fac}),i})();class v{static getUpdateInformation(s){const e=s.attrCode,t=s.groupId;if(e&&t)return{standardAttributeCode:e.toString(),tabId:t};throw new Error("Attribute code of group id not present: "+JSON.stringify(s))}static findFirstChangedAttribute(s){const e=s.groups[0];if(e.attributes)return e.attributes[0];throw new Error("No changed attributes found")}}let w=(()=>{class i{convert(e){const t=v.findFirstChangedAttribute(e);let r;return r=e.updateType===a.Configurator.UpdateType.ATTRIBUTE_QUANTITY?this.convertQuantity(t,e.configId):this.convertAttribute(t,e.configId),r}convertQuantity(e,t){const r=v.getUpdateInformation(e);return{configurationId:t,standardAttributeCode:r.standardAttributeCode,changeAttributeValue:{quantity:e.quantity},tabId:r.tabId}}convertAttribute(e,t){const r=v.getUpdateInformation(e),n={configurationId:t,standardAttributeCode:r.standardAttributeCode,changeAttributeValue:{},tabId:r.tabId};return e.uiType===a.Configurator.UiType.DROPDOWN||e.uiType===a.Configurator.UiType.DROPDOWN_PRODUCT||e.uiType===a.Configurator.UiType.RADIOBUTTON||e.uiType===a.Configurator.UiType.RADIOBUTTON_PRODUCT||e.uiType===a.Configurator.UiType.SINGLE_SELECTION_IMAGE?n.changeAttributeValue.attributeValueIds=this.processSelectedSingleValue(e.selectedSingleValue):e.uiType===a.Configurator.UiType.CHECKBOXLIST||e.uiType===a.Configurator.UiType.CHECKBOXLIST_PRODUCT||e.uiType===a.Configurator.UiType.CHECKBOX||e.uiType===a.Configurator.UiType.MULTI_SELECTION_IMAGE?n.changeAttributeValue.attributeValueIds=this.prepareValueIds(e):(e.uiType===a.Configurator.UiType.STRING||e.uiType===a.Configurator.UiType.NUMERIC)&&(n.changeAttributeValue.userInput=e.userInput,n.changeAttributeValue?.userInput||(n.changeAttributeValue.userInput=" ")),n}processSelectedSingleValue(e){let t=e;return t||(t=","),t}prepareValueIds(e){let t="";const r=e.values?.filter(n=>n.selected);return r&&r.length>0?r.forEach(n=>{t+=n.valueCode+","}):t=",",t}}return i.\u0275fac=function(e){return new(e||i)},i.\u0275prov=u.Yz7({token:i,factory:i.\u0275fac}),i})(),G=(()=>{class i{convert(e){const t=v.findFirstChangedAttribute(e);return this.convertAttribute(t,e.configId)}convertAttribute(e,t){const r=v.getUpdateInformation(e),n=this.findFirstChangedValue(e);return{configurationId:t,standardAttributeCode:r.standardAttributeCode,attributeValueId:n.valueCode,quantity:n.quantity??1,tabId:r.tabId}}findFirstChangedValue(e){if(e.values&&e.values.length>0)return e.values[0];throw new Error("No values present")}}return i.\u0275fac=function(e){return new(e||i)},i.\u0275prov=u.Yz7({token:i,factory:i.\u0275fac}),i})();const T=new u.OlP("CpqConfiguratorNormalizer"),N=new u.OlP("CpqConfiguratorSerializer"),R=new u.OlP("CpqConfiguratorValueSerializer"),P=new u.OlP("CpqConfiguratorOverviewNormalizer");let B=(()=>{class i{}return i.\u0275fac=function(e){return new(e||i)},i.\u0275prov=u.Yz7({token:i,factory:function(e){let t=null;return t=e?new(e||i):u.LFG(f.DeH),t},providedIn:"root"}),i})(),Q=(()=>{class i{constructor(e){this.config=e,this.CPQ_MARKER_HEADER={headers:new O.WM({[$.O4]:"x"})}}buildUrl(e,t,r){const n=this.config.backend?.cpq?.endpoints;let o;switch(e){case"configurationInit":o=n?.configurationInit;break;case"configurationDisplay":o=n?.configurationDisplay;break;case"attributeUpdate":o=n?.attributeUpdate;break;case"valueUpdate":o=n?.valueUpdate}o||(o="configurations",console.warn(`${e} endpoint configuration missing for cpq backend, please provide it via key: "backend.cpq.endpoints.${e}"`));let l=this.config.backend?.cpq?.prefix+o;return l=t?f.leO.resolve(l,t):l,l=r?this.appendQueryParameters(l,r):l,l}appendQueryParameters(e,t){let r=e+"?";return t.forEach((n,o)=>{r=o>0?r+"&":r,r=`${r}${n.name}=${n.value}`}),r}}return i.\u0275fac=function(e){return new(e||i)(u.LFG(B))},i.\u0275prov=u.Yz7({token:i,factory:i.\u0275fac,providedIn:"root"}),i})(),K=(()=>{class i{constructor(e,t,r){this.http=e,this.converterService=t,this.endpointService=r}createConfiguration(e){return this.callConfigurationInit(e).pipe((0,C.w)(t=>this.callConfigurationDisplay(t.configurationId).pipe(this.converterService.pipeable(T),(0,d.U)(r=>({...r,configId:t.configurationId})))))}readConfiguration(e,t){return this.callConfigurationDisplay(e,t).pipe(this.converterService.pipeable(T),(0,d.U)(r=>({...r,configId:e})))}readConfigurationOverview(e){return this.getConfigurationWithAllTabsAndAttributes(e).pipe(this.converterService.pipeable(P),(0,d.U)(t=>({...t,configId:e})))}getConfigurationWithAllTabsAndAttributes(e){return this.callConfigurationDisplay(e).pipe((0,C.w)(t=>{const r=[];return t.tabs&&t.tabs.length>0?t.tabs.forEach(n=>{r.push(n.isSelected?(0,_.of)(t):this.callConfigurationDisplay(e,n.id.toString()))}):r.push((0,_.of)(t)),(0,X.D)(r)}),(0,d.U)(this.mergeTabResults))}mergeTabResults(e){const t={...e[e.length-1]};return t.attributes=void 0,t.tabs=[],e.forEach(r=>{let n;const o=r.tabs?.find(l=>l.isSelected);n=o&&r.tabs&&r.tabs.length>0?{...o}:{id:0},n.attributes=r.attributes,t.tabs?.push(n)}),t}updateAttribute(e){const t=this.converterService.convert(e,N);return this.callUpdateAttribute(t).pipe((0,C.w)(()=>this.callConfigurationDisplay(e.configId,t.tabId).pipe(this.converterService.pipeable(T),(0,d.U)(r=>({...r,configId:e.configId})))))}updateValueQuantity(e){const t=this.converterService.convert(e,R);return this.callUpdateValue(t).pipe((0,C.w)(()=>this.callConfigurationDisplay(e.configId,t.tabId).pipe(this.converterService.pipeable(T),(0,d.U)(r=>({...r,configId:e.configId})))))}callUpdateValue(e){return this.http.patch(this.endpointService.buildUrl("valueUpdate",{configId:e.configurationId,attributeCode:e.standardAttributeCode,valueCode:e.attributeValueId}),{Quantity:e.quantity},this.endpointService.CPQ_MARKER_HEADER)}callConfigurationInit(e){return this.http.post(this.endpointService.buildUrl("configurationInit"),{ProductSystemId:e},this.endpointService.CPQ_MARKER_HEADER)}callConfigurationDisplay(e,t){return this.http.get(this.endpointService.buildUrl("configurationDisplay",{configId:e},t?[{name:"tabId",value:t}]:void 0),this.endpointService.CPQ_MARKER_HEADER)}callUpdateAttribute(e){return this.http.patch(this.endpointService.buildUrl("attributeUpdate",{configId:e.configurationId,attributeCode:e.standardAttributeCode}),e.changeAttributeValue,this.endpointService.CPQ_MARKER_HEADER)}}return i.\u0275fac=function(e){return new(e||i)(u.LFG(O.eN),u.LFG(f.IXI),u.LFG(Q))},i.\u0275prov=u.Yz7({token:i,factory:i.\u0275fac,providedIn:"root"}),i})(),W=(()=>{class i{constructor(e,t){this.cpqRestService=e,this.cpqOccService=t}getConfiguratorType(){return"CLOUDCPQCONFIGURATOR"}createConfiguration(e){return this.cpqRestService.createConfiguration(e.id).pipe((0,d.U)(t=>(t.owner=e,t)))}readConfiguration(e,t,r){return this.cpqRestService.readConfiguration(e,t).pipe((0,d.U)(n=>(n.owner=r,n)))}updateConfiguration(e){return(e.updateType===a.Configurator.UpdateType.VALUE_QUANTITY?this.cpqRestService.updateValueQuantity:this.cpqRestService.updateAttribute).call(this.cpqRestService,e).pipe((0,d.U)(r=>(r.owner=e.owner,r)))}updateConfigurationOverview(){throw new Error("Update the configuration overview is not supported for the CPQ configurator")}addToCart(e){return this.cpqOccService.addToCart(e)}readConfigurationForCartEntry(e){return this.cpqOccService.getConfigIdForCartEntry(e).pipe((0,C.w)(t=>this.cpqRestService.readConfiguration(t).pipe((0,d.U)(r=>(r.owner=e.owner,r)))))}updateConfigurationForCartEntry(e){return this.cpqOccService.updateCartEntry(e)}readConfigurationForOrderEntry(e){return this.cpqOccService.getConfigIdForOrderEntry(e).pipe((0,C.w)(t=>this.cpqRestService.readConfiguration(t).pipe((0,d.U)(r=>(r.owner=e.owner,r)))))}readPriceSummary(e){return(0,_.of)(e)}getConfigurationOverview(e){return this.cpqRestService.readConfigurationOverview(e)}searchVariants(){throw new Error("searchVariants is not supported for the CPQ configurator")}}return i.\u0275fac=function(e){return new(e||i)(u.LFG(K),u.LFG(V))},i.\u0275prov=u.Yz7({token:i,factory:i.\u0275fac}),i})();const x={backend:{cpq:{endpoints:{configurationInit:"configurations",configurationDisplay:"configurations/${configId}/display",attributeUpdate:"configurations/${configId}/attributes/${attributeCode}",valueUpdate:"configurations/${configId}/attributes/${attributeCode}/attributeValues/${valueCode}"},prefix:"/api/configuration/v1/"}}};let k=(()=>{class i{}return i.\u0275fac=function(e){return new(e||i)},i.\u0275mod=u.oAB({type:i}),i.\u0275inj=u.cJS({providers:[{provide:a.RulebasedConfiguratorConnector.CONFIGURATOR_ADAPTER_LIST,useClass:W,multi:!0},{provide:T,useClass:F,multi:!0},{provide:N,useClass:w,multi:!0},{provide:R,useClass:G,multi:!0},{provide:P,useClass:z,multi:!0},(0,f.i51)(x)],imports:[I.ez]}),i})(),Z=(()=>{class i{}return i.\u0275fac=function(e){return new(e||i)},i.\u0275mod=u.oAB({type:i}),i.\u0275inj=u.cJS({imports:[q,k]}),i})()}}]);